<%= frontmatter(
  description: 'Applies project idiomatic test conventions, structure, and best practices when writing or modifying unit tests. What this does is defining a set of rules to follow when dealing with any test file from this project. Use this when the user is asking to create, edit, refactor, or review test files or when dealing with any test scenario. Use this when editing any file under the `spec/` directory.',
  metadata: {
    dependencies: %w[
      Muriel-Salvan/x-aeon_agents_skills:applying-test-conventions
    ]
  }
) %>

# <%= skill_goal 'Applying project test conventions' %>

Those conventions apply to any file inside the `spec/` directory.

## Inform the user

- <%= announce_skill %>

## Conventions on test files layout

<%= rule(
  'Add any platform-agnostic test scenarios under the `spec/scenarios` directory',
  rationale: 'Unit tests from spec/scenarios should always be run on any platform.'
) %>

<%= rule(
  'Add any platform-specific test scenarios under the `spec/scenarios.\#{RUBY_PLATFORM}` directory',
  rationale: 'Platform-specific unit tests can be easily identified and will be selected when run on a given platform.'
) %>

<%= rule(
  'Define common test helpers and framework under the `spec/ruby_neural_nets_test` directory',
  rationale: 'Reusable helpers and test frameworks components should be defined separately from scenarios. They also follow standard Ruby module names and files layouts.'
) %>

<%= rule(
  'Group test scenarios per interface kind',
  description: <<~EO_Markdown,
    Only the following interface kinds are tested:
      * Data loaders are under `spec/scenarios/data_loaders`.
      * Models are under `spec/scenarios/models`.
      * Trainers are under `spec/scenarios/trainers`.
  EO_Markdown
  rationale: 'Separating test scenarios per interface gives a simple way to organize and select test scenarios to be run.'
) %>

<%= rule(
  'Name the test file `spec/{scenarios_kind}/{interface_kind}/{class_name}_spec.rb` inside its scenarios directory',
  rationale: 'This follows standard RSpec best practices.'
) %>

<%= rule(
  'Split big test scenarios files',
  description: 'In the case too many scenarios have to be tested for a single class, then split the scenarios among different files, all part of the same directory, named `spec/{scenarios_kind}/{interface_kind}/{class_name}/{scenarios_group_meaning}_spec.rb` inside their scenarios directory.',
  rationale: 'This follows standard RSpec best practices and provides a way to better organize big test suites.'
) %>

<%= rule(
  'Define shared scenarios in `spec/scenarios/{interface_kind}/shared/`',
  description: 'Add any shared test scenarios (shared between different spec files) in files named `spec/scenarios/{interface_kind}/shared/{common_functionality}_scenarios.rb`. Include the shared scenarios in all spec files that have this common functionality, using RSpec\'s `include_examples` method.',
  rationale: 'This reduces duplication in common features to be tests between various test suites. It keeps our test scenarios DRY.'
) %>

## Apply common test conventions

- Always use `skill: applying-test-convention` skill to also understand common test conventions.
- Project's conventions from this skill should always be preferred if they conflict with conventions from the `applying-test-convention` skill.

## When to use it

- Always use it every time the user asks you create or modify test files or test scenarios.
- Always use it every time another skill specifically mentions `skill: <%= skill_name %>`.
- Always use it every time you need to write or modify any test file under `spec/` directory.
